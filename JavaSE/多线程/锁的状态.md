# 锁的状态

> 锁的状态总共有四种：**无锁状态**、**偏向锁**、**轻量级锁**和**重量级锁**。
>
> 随着锁的竞争，锁可以从偏向锁升级到轻量级锁，再升级到重量级锁（锁的升级是单向的，也就是说只能从低级到高级，不会出现锁降级）。

## 锁的状态详解

### 偏向锁

**定义**

> Java1.6 引入的一种多线程优化。它通过消除无竞争情况下的同步原语，进一步提高程序的运行性能。这里所谓的无竞争场景指的是单线程访问带同步的资源或方法。

**实现原理**

> 偏向锁，顾名思义，它会偏向第一个访问锁的线程，如果在接下来的运行过程中，该锁没有被其他的线程访问，则持有偏向锁的线程将永远不需要触发同步。如果在运行过程中，遇到了其他线程抢占锁，则持有偏向锁的线程会被挂起，JVM会尝试消除它身上的偏向锁，将锁恢复到标准的轻量级锁。

**具体流程**

![image-20200322230038116](https://i.loli.net/2020/03/22/KShBx2ip14mjL9J.png)

### 轻量级锁

**定义**

> 轻量级锁本意是为了减少多线程进入互斥的状态，并不是要代替互斥。它利用CPU原语Compare-Add-Swap（CAS），尝试在进入互斥体前，进行补救。

**基本实现流程**

![image-20200322230147184](https://i.loli.net/2020/03/22/WoRKbqvgJNi1fLQ.png)

**轻量级锁与偏向锁的区别**

> 轻量级锁也是一种多线程优化，它与偏向锁的区别在于，轻量级锁是通过CAS来避免进入开销较大的互斥操作，而偏向锁是在无竞争场景下完全消除同步，连CAS也不执行（CAS本身仍旧是一种操作系统同步原语，始终要在JVM与OS之间来回，有一定的开销）。

## 其他

> 默认理解锁不存在降级的情况