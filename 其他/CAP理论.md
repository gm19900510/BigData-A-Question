# CAP 理论

一个分布式系统不可能同时满足 **一致性（Consistency）**、**可用性（Availability）** 和 **分区容错性（Partition tolerance）** 这三个基本需求，最多只能同时满足其中的两项。

## 一致性（Consistency）

> All nodes see the same data at the same time

- 强一致性：不同线程提交的多个写请求，其他线程能立即看到，并且看到的顺序与提交时的顺序一致
- 顺序一致性：同一个线程提交的多个写请求，其他线程最终看到的顺序与提交时的顺序一致
- 最终一致性：任何一个写请求，最终都能被其他线程看到
  - 因果一致性：仅要求有因果关系的读写请求，顺序得到保证
  - 读你所写一致性：本线程的读写请求，在本线程内顺序得到保证
  - 会话一致性：本会话的读写请求，在本会话内顺序得到保证
  - 单调读一致：本线程的读请求顺序得到保证，读到新值之后不会再读到旧值
  - 单调写一致：本线程的写请求顺序得到保证，写入新值之后不会被旧值覆盖

> 分布式系统的一致性指的是强一致性

## 可用性（Availability）

> Every request gets a response on success/failure

系统提供的服务一直处于可用的状态，每个请求总是能在有限的时间内返回结果

## 分区容错性（Partition tolerance）

> System continues to work despite message loss or partial failure

系统在节点或网络故障等情况下仍能提供满足一致性和可用性的服务。

## 寻求平衡

**对于分布式系统而言，分区容错性是最基本的要求，而不是可选项**。

放弃可用性：遇到节点或网络故障时，为了保证一致性，服务将降级或不可用

放弃一致性：为了保证可用性，不再追求数据的实时一致性，只承诺最终的一致性

## BASE 理论

基本可用(Basically Available)：发生故障时损失部分功能或响应时间
软状态(Soft state)：允许数据存在中间状态，即允许数据同步过程存在延时
最终一致性(Eventually consistent)：所有数据副本经过同步最终达到一致状态

## NWR 理论

- N：数据副本的数量
- W：写请求需要写入的副本数量
- R：读请求需要读取的副本数量

通常要求 `W>N/2`

当 `W+R>N` 时，可以认为系统是强一致性的
当 `W+R<=N` 时，可以认为系统是弱一致性的