### 事实表（Fact Table）

事实表（Fact Table）是指存储有事实记录的表，如系统日志、销售记录等；事实表的记录在不断地动态增长，所以它的体积通常远大于其他表。

### 维度表（Dimension Table）

维度表或维表，有时也称为查找表（Lookup Table），是与事实表相对应的一种表。它保存了维度的属性值，可以跟事实表做关联；相当于将事实表上经常重复出现的属性抽取、规范出来用一张表进行管理。

维度表有以下几个优点：

- 缩小了事实表的大小；
- 便于维度的管理和维护，不必对事实表进行改动；
- 维度表可以为多个事实表重用，以减少重复工作。

### 维度（Dimension）

维度是观察数据的角度，一般是一组离散的值。因此统计时可以把维度值相同的记录聚合在一起，然后进行聚合计算。

在 Kylin Cube 构建中，维度可以分为以下几种类型：

- **Mandatory**：必需维度，查询中总是出现在 where 条件中的维度；如果一个维度被标记为“Mandatory”，会认为所有的查询都会包含此维度，所有不含此维度的组合，在 Cube 构建时都会被剪枝（不计算）
- **Hierarchy**：层级维度，如果多个维度之间有层级（或包含）的关系，通过设置为 Hierarchy，那些不满足层级的组合会被剪枝；如果A、B、C是层级，并且 A>B>C，那么只需要计算组合A、AB、ABC；其他组合如B、C、BC，AC 将不做预计算；
- **Joint**：联合维度，有些维度往往一起出现，或者他们的基数非常接近（有 1:1 映射关系），例如“用户ID”总是对应唯一的“用户名”；
- **Derived**：衍生维度，维度表的列值，可以从它的主键值衍生而来，那么通过将这些列定义为衍生维度，可以仅将主键加入到 Cube 的预计算来，而在运行时通过使用维度表的快照，衍生出非主键列的值，从而起到降维的效果。

### 维度的基数（Cardinality）

维度的基数指的是该维度在数据集中出现的不同值的个数；例如“国家”是一个维度，如果有200个不同的值，那么此维度的基数就是200。通常一个维度的基数会从几十到几万个不等，个别维度如“用户ID”的基数会超过百万甚至千万。**基数超过一百万的维度通常被称为超高基数维度（Ultra High Cardinality，UHC），需要引起设计者的注意**。

Cube中所有维度的基数都可以体现出Cube的复杂度，如果一个Cube中有好几个超高基数维度，那么这个Cube膨胀的概率就会很高。在创建Cube前需要对所有维度的基数做一个了解，这样就可以帮助设计合理的Cube。计算基数有多种途径，最简单的方法就是让 Hive执行一个countdistinct的SQL查询；Kylin也提供了计算基数的方法，Kylin 对基数的计算方法采用的是HyperLogLog的近似算法，与精确值略有误差，但作为参考值已经足够了。

### 度量（Measure）

度量是被聚合的统计值，也是聚合运算的结果，它一般是连续的值

### 数据立方体（Data Cube）

数据立方体允许多维对数据建模和观察，它由维和事实定义，它是对多维模型的一个形象的说法。

从表方面看，数据立方体是三维的，但是多维模型不仅限于三维模型，可以组合更多的模型，比如四维、五维等等，比如我们根据时间、地域、产品和产品型号这四个维度，统计销售量等指标。

对于每一种维度的组合，将度量做聚合运算，然后将运算的结果保存为一个物理视图，称为 **Cuboid**。所有维度组合的 Cuboid 作为一个整体，被称为 **Cube**。所以说，一个 Cube 就是许多按维度聚合的物化视图的集合。 

**Cube Segment** 是指针对源数据中的某一个片段，计算出来的 Cube 数据。通常数据仓库中的数据数量会随着时间的增长而增长，而 Cube Segment 也是按时间顺序来构建的。

Cuboid 示例：`Cuboid[Time, Locatio] = select Time, Location, sum(GMV) as GMV from T group by Time, Location`

![img](../images/16672d9986eb24de)

### Cube 构建常见概念

- **Table**：表，是 Cube 的数据源；在创建 Cube 之前，需要从数据源（通常为 Hive）同步表的元数据，包括表名、列名、列属性等
- **Data Model**：数据模型，定义了由若干张表的一个连接关系。支持星型模型的多维分析；在创建 Cube 分析之前，用户需定义一个数据模型。一个模型可以被多个 cube 使用。
- **Cube**：数据立方体，是一种多维分析的技术，通过预计算，将计算结果存储在某多个维度值所映射的空间中；在运行时通过对 Cube 的再处理而快速获取结果
- **Partition**：分区，用户可以定义个分区日期或时间列，随后对 Cube 的构建按此列的值范围而进行，从而将 Cube 分成多个 Segment
- **Cube Segment**：每个 Cube Segment 是对特定时间范围的数据计算而成的 Cube，每个 Segment 对应一张 HBase 表
- **Aggregation Group**：聚合组，每个聚合组是全部维度的一个子集；通过将很多个维度分组，并把常一起使用的维度放在一起，可以有效降低 Cube 的组合数

### Cube 常见操作

#### 钻取

Cube 是多维的，有多个维度，每个维度可以看成一个树枝，上面有下一级别的枝桠，那么钻取，可以理解为从一个树枝到他下面的树枝上去，可以层层钻取，往下即为**下钻（drill down）**，往上可称**上钻或上卷（roll up）**。

例如，如果您在检查手机产品的销售总额，则可以下钻查看具体子类的销售额，比如苹果，华为分别卖了多少钱。或者，如果您在检查了所有子类销售总额后，还可以上钻查看父类的销售总额。

#### 旋转（pivot）

旋转就是指改变报表或页面的展示方向。是维度的切换，换个角度看问题，譬如我将我看的一个交叉表（crosstable）几个维度换来换去来查看数据集，换个角度能够得到不同的信息的。对于使用者来说，就是个视图操作，而从SQL模拟语句的角度来说，就是改变SELECT后面字段的顺序而已。

#### 切片（slice）

是在一部分维上选定值后，关心度量数据在剩余维上的分布。如果剩余的维只有两个，则是切片；如果有三个或以上，则是切块。

切片：选择维中特定的值进行分析，比如只选择电子产品进行分析

切块：选择维中特定的区间或者某批特定值进行分析，比如选择电子产品和日用品进行分析

