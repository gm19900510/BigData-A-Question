# 多路查找树（B树）

> **多路查找树（muitl-way search tree），其每一个结点的孩子数可以多于两个，且每一个结点处可以存储多个元素**。

由于它是查找树，所有元素之间存在某种特定的排序关系。

多路查找树的 4 种特殊形式：
- 2-3树
- 2-3-4树
- B树
- B+树

## 2-3 树

> **2-3 树是这样的一棵多路查找树：其中的每一个结点都具有两个孩子（我们称它为 2 结点）或三个孩子（我们称它为 3 结点）**

**一个 2 结点包含一个元素和两个孩子或没有孩子**，且与二叉排序树类似，左子树包含的元素小于该元素，右子树包含的元素大于该元素。不过与二叉排序树不同的是，这个 2 结点要么没有孩子，要有就有两个，不能只有一个孩子。

**一个 3 结点包含一小一大两个元素和三个孩子或没有孩子**，一个 3 结点要么没有孩子，要么具有 3 个孩子。如果某个 3 结点有孩子的话，左子树包含小于较小元素的元素，右子树包含大于较大元素的元素，中间子树包含介于两元素之间的元素。

## 2-3-4 树

2-3-4 树其实就是 2-3 树的概念扩展，包括了 4 结点的使用。一个 4 结点包含小中大三个元素和四个孩子或者没有孩子，一个 4 结点要么没有孩子，要么具有 4 个孩子。如果某个 4 结点有孩子的话，左子树包含小于最小元素的元素；第二个子树包含大于最小元素，小于第二元素的元素；第三子树包含大于第二元素，小于最大元素的元素；右子树包含大于最大元素的元素。

## B 树

**B 树（B-tree）是一种平衡的多路查找树**，2-3 树和 2-3-4 树都是 B 树的特例。**结点最大的孩子数目称为 B 树的阶（order）**，因此 2-3 树是 3 阶 B 树，2-3-4 树是 4 阶 B 树。

一个 m 阶的 B 树具有如下属性：
- 如果根结点不是叶结点，则其至少有两棵子树；
- 每一个非根的分支结点都有 $k-1$ 个元素和 $k$ 个孩子，其中 $\left \lceil m/2 \right \rceil \leqslant k \leqslant m$。每一个叶子结点 n 都有 k-1 个元素，其中 $\left \lceil m/2 \right \rceil \leqslant k \leqslant m$
- 所有叶子结点都位于同一层次
- 所有分支结点包含下列信息数据 $(n,A_{0},K_{1},A_{1},K_{2},A_{2},\cdots,K_{n},A_{n})$，其中：$K_{i} (i=1,2,\cdots,n)$ 为关键字，且 $K_{i}<K_{i+1} (i=1,2,\cdots,n-1)$；$A_{i} (i=0,2,\cdots,n)$ 为指向子树根结点的指针，且指针 $A_{i-1}$ 所指子树中所有结点的关键字均小于 $K_{i} (i=1,2,\cdots,n)$，$A_{n}$ 所指子树中所有结点的关键字均大于 $K_{n}$，$n(\left \lceil m/2 \right \rceil - 1 \leqslant n \leqslant m-1)$ 为关键字的个数或 $n+1$ 为子树的个数

## B+ 树

B+ 树是应文件系统所需而出的一种 B 树的变形树，注意严格意义上讲，它其实已经不符合树的定义了。在 B 树中，每一个元素在该树中只出现一次，有可能在叶子结点上，也有可能在分支结点上。而在 B+ 树中，出现在分支结点中的元素会被当做它们在该分支结点位置的中序后继者（叶子结点）中再次列出。另外，每一个叶子结点都会保存一个指向后一叶子结点的指针。

一棵 m 阶的 B+ 树和 m 阶的 B 树的差异在于：
- 有 n 棵子树的结点中包含有 n 个关键字；
- 所有叶子结点包含全部关键字的信息，及指向含这些关键字记录的指针，叶子结点本身依关键字的大小自小而大顺序链接；
- 所有分支结点可以看成是索引，结点中仅含有其子树中最大（或最小）关键字

这样的数据结构最大的好处在于，如果要随机查找，就从根结点出发，与 B 树的查找方式相同，只不过即使在分支结点找到了待查找的关键字，它也只是用来索引的，不能提供实际记录的访问，还是需要到达包含此关键字的终端结点。

如果需要从最小关键字进行从小到大的顺序查找，就可以从最左侧的叶子结点出发，不经过分支结点，而是沿着指向下一叶子的指针就可以遍历所有的关键字。

B+ 树的结构特别适合带有范围的查找。