# 索引优化

> 索引数据的规划，应在前期做好规划，正所谓"**设计先行，编码在后**"，这样才能有效的避免突如其来的数据激增导致集群处理能力不足引发的线上客户检索或者其他业务受到影响

## 设计阶段优化

1. 根据业务增量需求，采取基于日期模板创建索引，通过 roll over API 滚动索引
2. 使用别名进行索引管理
3. 每天凌晨定时对索引做 force_merge 操作，以释放空间
4. 采取冷热分离机制，热数据存储到 SSD，提高检索效率；冷数据定期进行 shrink 操作，以缩减存储
5. 采取 curator 进行索引的生命周期管理
6. 仅针对需要分词的字段，合理的设置分词器
7. Mapping 阶段充分结合各个字段的属性，是否需要检索、是否需要存储等

## 写入优化

1. 写入前副本数设置为 0
2. 写入前关闭 refresh_interval 设置为 -1，禁用刷新机制
3. 写入过程中，采取 bulk API 进行批量写入
4. 写入后恢复副本数和刷新间隔
5. 尽量使用自动生成的 id

## 查询优化

1. 禁用 wildcard
2. 禁用批量 terms（成百上千的场景）
3. 充分利用倒排索引机制，能 keyword 类型尽量 keyword
4. 数据量大时候，可以先基于时间敲定索引再检索
5. 设置合理的路由机制